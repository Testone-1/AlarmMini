<!-- 알림 소리 및 음량 조절 기능 포함된 수정 버전 -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>미니파이터 클래식 서버 컨텐츠 일정표_By 꽃게랑</title>
  <style>
    /* 생략: 기존 스타일 동일 */
    /* 아래에 사운드 바 추가 스타일 */
    .volume-control {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--box-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
    }
    .volume-control input[type=range] {
      width: 100px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <!-- 기존 내용은 그대로 유지 -->
  <div class="compact">
    <!-- ...중략... -->
    <div class="test-alarm">
      <button onclick="testNotification()">🔔 알림 테스트 버튼 (5초 후 알림)</button>
    </div>
  </div>

  <!-- 🔊 볼륨 조절 바 추가 -->
  <div class="volume-control">
    🔉 볼륨:
    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
  </div>

  <!-- 알림음 오디오 추가 -->
  <audio id="alarm-sound" src="https://actions.google.com/sounds/v1/alarms/bugle_tune.ogg" preload="auto"></audio>

  <script>
    function toggleMode() {
      const body = document.body;
      const btn = document.querySelector('.mode-toggle');
      body.classList.toggle('light');
      btn.textContent = body.classList.contains('light') ? '☀️ 라이트 모드' : '🌙 다크 모드';
    }

    function toggleAll(prefix, state) {
      const checkboxes = document.querySelectorAll(`input[id^="${prefix}-"]`);
      checkboxes.forEach(cb => {
        if (!cb.id.includes("notify")) {
          cb.checked = state;
          localStorage.setItem(cb.id, state ? '1' : '0');
        }
      });
    }

    function loadState() {
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        const stored = localStorage.getItem(cb.id);
        if (stored !== null) cb.checked = stored === '1';
        cb.addEventListener('change', () => {
          localStorage.setItem(cb.id, cb.checked ? '1' : '0');
        });
      });

      const shipBtn = document.getElementById('ship-toggle');
      const shipDone = localStorage.getItem('ship-done') === '1';
      updateShipBtn(shipDone);
    }

    function updateShipBtn(done) {
      const btn = document.getElementById('ship-toggle');
      btn.textContent = done ? '✅ 완료' : '❌ 미완료';
      localStorage.setItem('ship-done', done ? '1' : '0');
    }

    document.getElementById('ship-toggle').addEventListener('click', () => {
      const current = localStorage.getItem('ship-done') === '1';
      updateShipBtn(!current);
    });

    function requestNotificationPermission() {
      if (Notification.permission !== "granted") {
        Notification.requestPermission();
      }
    }

    function playAlarmSound() {
      const sound = document.getElementById('alarm-sound');
      sound.currentTime = 0;
      sound.play();
    }

    function scheduleNotifications() {
      const timeMap = {
        '1130': '11:30', '1430': '14:30', '1730': '17:30', '2130': '21:30', '0230': '02:30',
        '1000': '10:00', '1300': '13:00', '1600': '16:00', '2000': '20:00', '0100': '01:00',
        '1200': '12:00', '1500': '15:00', '1800': '18:00', '2200': '22:00', '2100': '21:00'
      };

      setInterval(() => {
        const now = new Date();
        for (const id in timeMap) {
          const types = ['boss', 'fight', 'fish', 'castle'];
          for (const type of types) {
            const checkbox = document.getElementById(`notify-${type}-${id}`);
            if (checkbox && checkbox.checked) {
              const [h, m] = timeMap[id].split(':');
              const target = new Date();
              target.setHours(parseInt(h));
              target.setMinutes(parseInt(m) - 5);
              target.setSeconds(0);

              const diff = target - now;
              if (diff >= 0 && diff < 1000) {
                new Notification(`${type.toUpperCase()} - ${timeMap[id]} 시작 5분 전!`);
                playAlarmSound();
              }
            }
          }
        }
      }, 1000);
    }

    function testNotification() {
      setTimeout(() => {
        new Notification("✅ 테스트 알림입니다!");
        playAlarmSound();
      }, 5000);
    }

    // 볼륨 조절
    document.getElementById("volume-slider").addEventListener("input", function () {
      const audio = document.getElementById("alarm-sound");
      audio.volume = parseFloat(this.value);
    });

    window.onload = () => {
      requestNotificationPermission();
      loadState();
      scheduleNotifications();
    };
  </script>
</body>
</html>
