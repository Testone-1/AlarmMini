<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>미니파이터 클래식 서버 컨텐츠 일정표</title>
  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #111;
      --box-bg: #fff;
      --border-color: #ccc;
    }
    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #f0f0f0;
      --box-bg: #2c2c2c;
      --border-color: #444;
    }
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .mode-toggle {
      padding: 6px 12px;
      background: transparent;
      border: 1px solid var(--text-color);
      border-radius: 5px;
      color: var(--text-color);
      cursor: pointer;
    }
    #ship-status {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      font-size: 16px;
      font-weight: bold;
    }
    #ship-toggle {
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    .grid {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      max-width: 900px;
      margin: 0 auto;
    }
    .column {
      flex: 1;
      min-width: 300px;
    }
    .box {
      background-color: var(--box-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 12px;
    }
    .box h3 {
      margin: 0 0 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
    }
    .checkbox-group label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 14px;
    }
    .test-alarm {
      text-align: right;
      margin-top: 30px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    .test-alarm button {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #555;
      color: white;
    }
    body.dark .test-alarm button {
      background-color: #ccc;
      color: #000;
    }
    .volume-control {
      text-align: right;
      margin-top: 10px;
      font-size: 14px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    input[type="range"] {
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>미니파이터 클래식 서버 컨텐츠 일정표</h2>
    <button class="mode-toggle" onclick="toggleMode()">☀️ 라이트/다크</button>
  </div>

  <div id="ship-status">
    <span>🛳️ 오늘 함선 완료 여부:</span>
    <button id="ship-toggle">❌ 미완료</button>
  </div>

  <div class="grid">
    <div class="column">
      <div class="box">
        <h3>(상급) 보스존 <label><input type="checkbox" id="notify-boss"> 5분 전 알림</label></h3>
        <div class="checkbox-group">
          <label><span>11:30</span><input type="checkbox" id="boss-1130"></label>
          <label><span>17:30</span><input type="checkbox" id="boss-1730"></label>
          <label><span>23:30</span><input type="checkbox" id="boss-2330"></label>
        </div>
      </div>
      <div class="box">
        <h3>천하제일대회 <label><input type="checkbox" id="notify-tournament"> 5분 전 알림</label></h3>
        <div class="checkbox-group">
          <label><span>13:30</span><input type="checkbox" id="tournament-1330"></label>
          <label><span>21:30</span><input type="checkbox" id="tournament-2130"></label>
        </div>
      </div>
    </div>

    <div class="column">
      <div class="box">
        <h3>낚시대회 <label><input type="checkbox" id="notify-fishing"> 5분 전 알림</label></h3>
        <div class="checkbox-group">
          <label><span>12:00</span><input type="checkbox" id="fishing-1200"></label>
          <label><span>18:00</span><input type="checkbox" id="fishing-1800"></label>
        </div>
      </div>
      <div class="box">
        <h3>공성전 <label><input type="checkbox" id="notify-war"> 5분 전 알림</label></h3>
        <div class="checkbox-group">
          <label><span>21:00</span><input type="checkbox" id="war-2100"></label>
        </div>
      </div>
    </div>
  </div>

  <div class="test-alarm">
    <button onclick="testNotification()">🔔 알림 테스트 버튼 (5초 후 알림)</button>
  </div>

  <div class="volume-control">
    🔊 알림 볼륨:
    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
  </div>

  <audio id="alarm-sound" src="https://actions.google.com/sounds/v1/alarms/bugle_tune.ogg" preload="auto"></audio>

  <script>
    const audio = document.getElementById('alarm-sound');
    const volumeSlider = document.getElementById('volume-slider');
    audio.volume = volumeSlider.value;
    volumeSlider.addEventListener('input', () => {
      audio.volume = volumeSlider.value;
    });

    const shipBtn = document.getElementById('ship-toggle');
    shipBtn.addEventListener('click', () => {
      const current = shipBtn.textContent.includes('✅');
      shipBtn.textContent = current ? '❌ 미완료' : '✅ 완료';
      localStorage.setItem('ship-status', current ? '0' : '1');
    });

    function loadState() {
      const stored = localStorage.getItem('ship-status');
      if (stored === '1') shipBtn.textContent = '✅ 완료';

      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        const saved = localStorage.getItem(cb.id);
        if (saved) cb.checked = saved === '1';
        cb.addEventListener('change', () => {
          localStorage.setItem(cb.id, cb.checked ? '1' : '0');
        });
      });
    }

    function toggleMode() {
      document.body.classList.toggle('dark');
    }

    function testNotification() {
      setTimeout(() => {
        if (Notification.permission === 'granted') {
          new Notification("🔔 테스트 알림입니다!");
          audio.currentTime = 0;
          audio.play();
        }
      }, 5000);
    }

    function checkAlarms() {
      const now = new Date();
      const times = [
        { id: 'notify-boss', hours: [11, 17, 23], minutes: 30 },
        { id: 'notify-tournament', hours: [13, 21], minutes: 30 },
        { id: 'notify-fishing', hours: [12, 18], minutes: 0 },
        { id: 'notify-war', hours: [21], minutes: 0 },
      ];
      times.forEach(group => {
        if (!document.getElementById(group.id).checked) return;
        group.hours.forEach(hour => {
          const alertTime = new Date();
          alertTime.setHours(hour);
          alertTime.setMinutes(group.minutes - 5);
          alertTime.setSeconds(0);
          alertTime.setMilliseconds(0);
          if (Math.abs(alertTime - now) < 1000) {
            if (Notification.permission === 'granted') {
              new Notification("⏰ 5분 전 알림입니다!");
              audio.currentTime = 0;
              audio.play();
            }
          }
        });
      });
    }

    if ('Notification' in window && Notification.permission !== 'granted') {
      Notification.requestPermission().then(permission => {
        if (permission !== 'granted') {
          alert("알림을 허용해야 알림 기능을 사용할 수 있어요!");
        }
      });
    }

    loadState();
    setInterval(checkAlarms, 1000);
  </script>
</body>
</html>
